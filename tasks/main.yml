---
# tasks file for openfire
- name: Get Openfire
  get_url:
    url: "http://www.igniterealtime.org/downloadServlet?filename=openfire/openfire_{{ openfire_version }}_all.deb"
    dest: "/tmp/openfire_{{ openfire_version }}.deb"

- name: Install java 7
  apt:
    update_cache: yes
    name: openjdk-7-jre

- name: Install Openfire
  apt:
    deb: "/tmp/openfire_{{ openfire_version }}.deb"

- name: upload configuration
  template:
    src: openfire/openfire.xml
    dest: /etc/openfire/openfire.xml
    owner: openfire
    group: openfire
  when: not new_install
  notify: restart openfire

- name: upload security assets
  unarchive:
    src: openfire/sec.tgz
    dest: /etc/openfire/
    owner: openfire
    group: openfire
  when: not new_install
  notify: restart openfire

- name: upload plugins
  unarchive:
    src: openfire/plugins.tgz
    dest: /var/lib/openfire/
    owner: openfire
    group: openfire
  when: not new_install
  notify: restart openfire
